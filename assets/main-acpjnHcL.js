import{i as B,f as W,a as H}from"./firebase-c45zIf7e.js";const j="AIzaSyD1g0WI_N1leSgBp92xcZ546MWkOo1kElQ",O="https://www.googleapis.com/drive/v3";async function E(e){const n=`'${e}' in parents and trashed = false`,o=`${O}/files?q=${encodeURIComponent(n)}&fields=${encodeURIComponent("files(id,name,mimeType)")}&key=${j}&orderBy=name`,r=await fetch(o);if(!r.ok)throw new Error(`Drive API error: ${r.status} ${r.statusText}`);return(await r.json()).files||[]}function k(e){return`https://drive.google.com/thumbnail?id=${e}&sz=w1600`}async function D(e){const n=await E(e);let t=null,o=null,r=null;for(const a of n){const i=a.name.toLowerCase();a.mimeType==="application/vnd.google-apps.folder"?i==="slideshow"?t=a.id:i==="qr-codes"&&(o=a.id):i.startsWith("background.")&&a.mimeType.startsWith("image/")&&(r=a.id)}return{slideshowFolderId:t,qrCodesFolderId:o,backgroundFileId:r}}async function Q(e){const n=await E(e),t=["jpg","jpeg","png","gif","webp"];return n.filter(o=>{const r=o.name.toLowerCase().split(".").pop();return t.includes(r)||o.mimeType.startsWith("image/")}).map(o=>({id:o.id,name:o.name,url:k(o.id)}))}async function R(e){const n=await E(e),t=["jpg","jpeg","png","gif","webp"];return n.filter(o=>{const r=o.name.toLowerCase().split(".").pop();return t.includes(r)||o.mimeType.startsWith("image/")}).sort((o,r)=>o.name.localeCompare(r.name)).slice(0,4).map(o=>{const r=o.name.replace(/\.[^.]+$/,"");return{id:o.id,name:o.name,label:r,url:k(o.id)}})}const _={ISNA:2,MWL:3,"Umm Al-Qura":4,Egyptian:5,Karachi:1,Tehran:7,"Shia Ithna-Ashari":0},U=[{ar:"إِنَّ الصَّلَاةَ تَنْهَىٰ عَنِ الْفَحْشَاءِ وَالْمُنكَرِ",en:"Indeed, prayer prohibits immorality and wrongdoing. (Quran 29:45)"},{ar:"وَمَا خَلَقْتُ الْجِنَّ وَالْإِنسَ إِلَّا لِيَعْبُدُونِ",en:"I did not create the jinn and mankind except to worship Me. (Quran 51:56)"},{ar:"فَاذْكُرُونِي أَذْكُرْكُمْ",en:"So remember Me; I will remember you. (Quran 2:152)"},{ar:"وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ",en:"And whoever puts his trust in Allah, then He will suffice him. (Quran 65:3)"},{ar:"إِنَّ اللَّهَ مَعَ الصَّابِرِينَ",en:"Indeed, Allah is with the patient. (Quran 2:153)"},{ar:"وَلَا تَيْأَسُوا مِن رَّوْحِ اللَّهِ",en:"And never give up hope of Allah's mercy. (Quran 12:87)"},{ar:"إِنَّ اللَّهَ لَا يُضِيعُ أَجْرَ الْمُحْسِنِينَ",en:"Indeed, Allah does not allow the reward of the doers of good to be lost. (Quran 9:120)"},{ar:"وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا",en:"And whoever fears Allah, He will make for him a way out. (Quran 65:2)"},{ar:"إِنَّمَا الْمُؤْمِنُونَ إِخْوَةٌ",en:"The believers are but brothers. (Quran 49:10)"},{ar:"لَا يُؤْمِنُ أَحَدُكُمْ حَتَّى يُحِبَّ لأَخِيهِ مَا يُحِبُّ لِنَفْسِهِ",en:"None of you truly believes until he loves for his brother what he loves for himself. (Bukhari & Muslim)"},{ar:"خَيْرُكُمْ أَحْسَنُكُمْ أَخْلَاقًا",en:"The best among you are those who have the best manners and character. (Bukhari)"},{ar:"مَنْ لَا يَشْكُرِ النَّاسَ لَا يَشْكُرِ اللَّهَ",en:"Whoever does not thank people has not thanked Allah. (Tirmidhi)"},{ar:"لَيْسَ الشَّدِيدُ بِالصُّرَعَةِ، إِنَّمَا الشَّدِيدُ الَّذِي يَمْلِكُ نَفْسَهُ عِندَ الْغَضَبِ",en:"The strong man is not the one who can overpower others. The strong man is the one who controls himself when angry. (Bukhari)"},{ar:"يَسِّرُوا وَلَا تُعَسِّرُوا",en:"Make things easy and do not make them difficult. (Bukhari)"},{ar:"وَلَا تَنَابَزُوا بِالْأَلْقَابِ",en:"And do not insult one another with nicknames. (Quran 49:11)"},{ar:"إِنَّ اللَّهَ يُحِبُّ الْمُحْسِنِينَ",en:"Indeed, Allah loves the doers of good. (Quran 2:195)"},{ar:"اقْرَأْ بِاسْمِ رَبِّكَ الَّذِي خَلَقَ",en:"Read in the name of your Lord who created. (Quran 96:1)"},{ar:"إِنَّ هَٰذَا الْقُرْآنَ يَهْدِي لِلَّتِي هِيَ أَقْوَمُ",en:"Indeed, this Quran guides to that which is most upright. (Quran 17:9)"},{ar:"وَلَقَدْ يَسَّرْنَا الْقُرْآنَ لِلذِّكْرِ",en:"And We have certainly made the Quran easy for remembrance. (Quran 54:17)"},{ar:"إِنَّ الَّذِينَ يَتْلُونَ كِتَابَ اللَّهِ وَأَقَامُوا الصَّلَاةَ",en:"Indeed, those who recite the Book of Allah and establish prayer. (Quran 35:29)"},{ar:"طَلَبُ الْعِلْمِ فَرِيضَةٌ عَلَى كُلِّ مُسْلِمٍ",en:"Seeking knowledge is obligatory upon every Muslim. (Ibn Majah)"},{ar:"مَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا",en:"Whoever takes a path in search of knowledge. (Abu Dawud)"},{ar:"إِنَّمَا يَخْشَى اللَّهَ مِنْ عِبَادِهِ الْعُلَمَاءُ",en:"Only those of His servants who have knowledge fear Allah. (Quran 35:28)"},{ar:"وَقُل رَّبِّ زِدْنِي عِلْمًا",en:"And say: My Lord, increase me in knowledge. (Quran 20:114)"},{ar:"مَنْ أَحْيَا سُنَّتِي فَقَدْ أَحْيَانِي",en:"Whoever revives my Sunnah has indeed revived me. (Tirmidhi)"},{ar:"مَنْ رَغِبَ عَنْ سُنَّتِي فَلَيْسَ مِنِّي",en:"Whoever turns away from my Sunnah is not from me. (Bukhari & Muslim)"},{ar:"مَنْ أَطَاعَنِي فَقَدْ أَطَاعَ اللَّهَ",en:"Whoever obeys me has obeyed Allah. (Bukhari & Muslim)"},{ar:"مَنْ رَأَى مِنْكُمْ مُنْكَرًا فَلْيُغَيِّرْهُ",en:"Whoever among you sees an evil, let him change it. (Muslim)"},{ar:"لَا يُؤْمِنُ أَحَدُكُمْ حَتَّى أَكُونَ أَحَبَّ إِلَيْهِ",en:"None of you truly believes until I am dearer to him than his father. (Bukhari)"},{ar:"إِنَّ اللَّهَ وَمَلَائِكَتَهُ يُصَلُّونَ عَلَى النَّبِيِّ",en:"Indeed, Allah and His angels send blessings upon the Prophet. (Quran 33:56)"},{ar:"قُلْ إِن كُنتُمْ تُحِبُّونَ اللَّهَ فَاتَّبِعُونِي",en:"Say: If you love Allah, then follow me. (Quran 3:31)"},{ar:"وَمَنْ أَظْلَمُ مِمَّن مَّنَعَ مَسَاجِدَ اللَّهِ أَن يُذْكَرَ فِيهَا اسْمُهُ",en:"And who is more unjust than one who prevents the mention of Allah's name in His mosques? (Quran 2:114)"},{ar:"مَنْ بَنَى مَسْجِدًا لِلَّهِ بَنَى اللَّهُ لَهُ بَيْتًا فِي الْجَنَّةِ",en:"Whoever builds a mosque for Allah, Allah will build for him a house in Paradise. (Bukhari & Muslim)"},{ar:"إِنَّ الْمَسَاجِدَ لِلَّهِ فَلَا تَدْعُوا مَعَ اللَّهِ أَحَدًا",en:"Indeed, the mosques are for Allah, so do not invoke anyone with Allah. (Quran 72:18)"},{ar:"فِي بُيُوتٍ أَذِنَ اللَّهُ أَن تُرْفَعَ وَيُذْكَرَ فِيهَا اسْمُهُ",en:"In houses which Allah has ordered to be raised and in which His name is mentioned. (Quran 24:36)"},{ar:"يَوْمَ تَشْهَدُ عَلَيْهِمْ أَلْسِنَتُهُمْ وَأَيْدِيهِمْ وَأَرْجُلُهُم بِمَا كَانُوا يَعْمَلُونَ",en:"On the Day when their tongues, hands and feet will bear witness against them as to what they used to do. (Quran 24:24)"},{ar:"فَمَن يَعْمَلْ مِثْقَالَ ذَرَّةٍ خَيْرًا يَرَهُ * وَمَن يَعْمَلْ مِثْقَالَ ذَرَّةٍ شَرًّا يَرَهُ",en:"So whoever does an atom's weight of good will see it. And whoever does an atom's weight of evil will see it. (Quran 99:7-8)"},{ar:"يَوْمَ لَا تَمْلِكُ نَفْسٌ لِّنَفْسٍ شَيْئًا",en:"On the Day when no soul will have power to do anything for another soul. (Quran 82:19)"},{ar:"وَكُلُّ إِنسَانٍ أَلْزَمْنَاهُ طَائِرَهُ فِي عُنُقِهِ",en:"And every person's fate We have fastened around his neck. (Quran 17:13)"}];let s=null,g=null,h=[],y=0,q=null,A=null,p=0;function w(e){return`mosque_${g}_${e}`}const z=1440*60*1e3;async function M(){if(B(),g=new URLSearchParams(window.location.search).get("mosque"),!g){K();return}try{s=await W(g)}catch(n){console.error("Failed to fetch mosque config:",n),T("Unable to load mosque configuration. Please check your connection and try again.");return}if(!s){T("Mosque not found. The mosque ID in the URL may be incorrect.");return}V(),await J()}function V(){const e=s;document.title=e.mosque?.pageTitle||e.mosque?.name||"Mosque Digital Signage";const n=document.querySelector(".header");n&&(n.textContent=e.mosque?.headerText||`Welcome to ${e.mosque?.name||"Our Mosque"}`);const t=e.display?.theme;if(t){const o=document.documentElement;t.headerBg&&o.style.setProperty("--header-bg",t.headerBg),t.panelBg&&o.style.setProperty("--panel-bg",t.panelBg),t.accentColor&&o.style.setProperty("--accent-color",t.accentColor),t.textColor&&o.style.setProperty("--text-color",t.textColor)}}async function J(){await v(),ie(),P(),ae(),se(),await G(),de()}async function K(){const e=document.querySelector(".main-layout");if(!e)return;e.innerHTML=`
    <div class="selector-screen">
      <h1>Mosque Digital Signage</h1>
      <p>Select your mosque</p>
      <div class="mosque-list" id="mosque-list">
        <p class="loading-text">Loading mosques...</p>
      </div>
    </div>
  `;const n=document.getElementById("mosque-list");try{const t=await H();if(t.length===0){n.innerHTML='<p>No mosques configured yet. Visit the <a href="admin.html">admin dashboard</a> to set one up.</p>';return}n.innerHTML="",t.forEach(o=>{const r=document.createElement("a");r.className="mosque-card",r.href=`?mosque=${o.id}`,r.innerHTML=`
        <div class="mosque-card-name">${o.name}</div>
        ${o.shortName?`<div class="mosque-card-short">${o.shortName}</div>`:""}
      `,n.appendChild(r)})}catch(t){console.error("Failed to load mosques:",t),n.innerHTML='<p class="error-text">Failed to load mosques. Please check your connection and try again.</p>'}}function T(e){const n=document.querySelector(".main-layout");n&&(n.innerHTML=`
    <div class="error-screen">
      <h1>Mosque Digital Signage</h1>
      <div class="error-message">${e}</div>
      <a href="?" class="error-link">Browse all mosques</a>
    </div>
  `)}async function G(){const e=s?.googleDrive?.rootFolderId;if(!e){console.log("No Google Drive folder configured, using placeholder content."),C();return}try{const n=Y();if(n){S(n);return}const t=await D(e),o={slideshowImages:[],qrCodes:[],backgroundFileId:t.backgroundFileId};t.slideshowFolderId&&(o.slideshowImages=await Q(t.slideshowFolderId)),t.qrCodesFolderId&&(o.qrCodes=await R(t.qrCodesFolderId)),Z(o),S(o)}catch(n){console.error("Failed to load Drive content:",n),C()}}function Y(){try{const e=localStorage.getItem(w("drive_content"));if(!e)return null;const n=JSON.parse(e);return Date.now()-n.timestamp>z?(localStorage.removeItem(w("drive_content")),null):n.content}catch{return null}}function Z(e){try{localStorage.setItem(w("drive_content"),JSON.stringify({timestamp:Date.now(),content:e}))}catch(n){console.warn("Failed to cache Drive content:",n)}}function S(e){if(e.backgroundFileId){const n=k(e.backgroundFileId),t=document.createElement("img");t.referrerPolicy="no-referrer",t.src=n,t.alt="",t.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;pointer-events:none;",document.body.prepend(t)}e.slideshowImages&&e.slideshowImages.length>0?(h=e.slideshowImages.map(n=>n.url),y=0,F(y),ee(),ne(h)):C(),e.qrCodes&&e.qrCodes.length>0?oe(e.qrCodes):re()}const c=document.getElementById("slideshow-img");function F(e){h.length===0||!c||(c.style.opacity=0,setTimeout(()=>{c.setAttribute("referrerpolicy","no-referrer"),c.src=h[e],c.onload=()=>{c.style.opacity=1},c.onerror=()=>{console.warn("Image failed to load:",h[e]),c.style.opacity=.2}},300))}function X(){h.length!==0&&(y===h.length-1&&te(),y=(y+1)%h.length,F(y))}function ee(){q&&clearInterval(q);const e=s?.display?.slideshowIntervalMs||8e3;q=setInterval(X,e)}async function te(){const e=s?.googleDrive?.rootFolderId;if(e)try{localStorage.removeItem(w("drive_content"));const n=await D(e);if(n.slideshowFolderId){const t=await Q(n.slideshowFolderId);t.length>0&&(h=t.map(o=>o.url),y>=h.length&&(y=0))}}catch(n){console.warn("Failed to refresh Drive images:",n)}}function C(){if(!c)return;c.style.display="none";const e=document.querySelector(".slideshow");if(e&&!e.querySelector(".placeholder-text")){const n=document.createElement("div");n.className="placeholder-text",n.textContent="No slideshow images configured. Add images to Google Drive.",e.appendChild(n)}}function ne(e){const n=document.querySelector(".slideshow");if(!n)return;const t=document.createElement("div");t.className="slideshow-gallery",e.forEach(o=>{const r=document.createElement("img");r.src=o,r.alt="Slideshow",r.setAttribute("referrerpolicy","no-referrer"),r.loading="lazy",t.appendChild(r)}),n.appendChild(t)}function oe(e){const n=document.querySelector(".qr-list");n&&(n.innerHTML="",e.forEach(t=>{const o=document.createElement("div");o.className="qr-wrapper";const r=document.createElement("div");r.className="qr-label",r.textContent=t.label;const a=document.createElement("img");a.className="qr-img",a.alt=t.label,a.setAttribute("referrerpolicy","no-referrer"),a.src=t.url,a.onerror=()=>{a.style.display="none";const i=document.createElement("div");i.className="qr-fallback",i.textContent=`QR: ${t.label}`,o.appendChild(i)},o.appendChild(r),o.appendChild(a),n.appendChild(o)}))}function re(){const e=document.querySelector(".qr-list");e&&(e.innerHTML='<div class="placeholder-text">No QR codes configured.</div>')}function ae(){const e=document.getElementById("prayer-times-list");if(!e)return;e.innerHTML="";const n=s?.location?.zipcode||"10001",t=s?.location?.country||"US",o=s?.prayerTimes?.calculationMethod||"ISNA",r=_[o]||2;fetch(`https://api.aladhan.com/v1/timingsByAddress?address=${n},${t}&method=${r}`).then(a=>a.json()).then(a=>{const i=a.data.timings;["Fajr","Dhuhr","Asr","Maghrib","Isha"].forEach(l=>{let m=i[l];if(m){m=m.replace(/\s*\(.*\)$/,"");let[$,N]=m.split(":"),f=parseInt($,10),b="AM";f===0?f=12:f===12?b="PM":f>12&&(f-=12,b="PM"),m=`${f}:${N} ${b}`}const I=document.createElement("li");I.textContent=`${l}: ${m}`,I.className="prayer-time-item",e.appendChild(I)});const d=s?.prayerTimes?.jummahTime;if(d){const l=document.createElement("li");l.textContent=`Jummah: ${d}`,l.className="prayer-time-item",e.appendChild(l)}}).catch(()=>{const a=s?.prayerTimes?.fallbackTimes||{Fajr:"5:30 AM",Dhuhr:"1:00 PM",Asr:"4:30 PM",Maghrib:"7:00 PM",Isha:"8:30 PM"};Object.entries(a).forEach(([u,d])=>{const l=document.createElement("li");l.textContent=`${u}: ${d}`,l.className="prayer-time-item",e.appendChild(l)});const i=s?.prayerTimes?.jummahTime;if(i){const u=document.createElement("li");u.textContent=`Jummah: ${i}`,u.className="prayer-time-item",e.appendChild(u)}})}function se(){const e=document.getElementById("ayats-content");if(!e)return;const n=(s?.announcements||[]).filter(d=>d.enabled),t=document.querySelector(".ayats"),o=document.querySelector(".main-layout");let r;const a=document.getElementById("mobile-announcement");if(n.length>0){r=n.map(l=>({en:l.text}));const d=s?.display?.announcementColor||s?.display?.theme?.accentColor||"#3b82f6";t&&(t.classList.add("has-announcements"),t.style.setProperty("--announcement-color",d)),o&&o.classList.add("has-announcements-layout"),a&&(a.style.display="",a.style.setProperty("--announcement-color",d))}else a&&(a.style.display="none"),t&&t.classList.remove("has-announcements"),o&&o.classList.remove("has-announcements-layout"),s?.customAyats&&s.customAyats.length>0?r=s.customAyats:r=U;p=0;function i(d){const m=r[d].en.replace(/[.]+(?=\s*\()/,"");e.innerHTML=`<div class="ayat-text">${m}</div>`,a&&n.length>0&&(a.textContent=m)}i(p);const u=s?.display?.ayatRotationIntervalMs||2e4;A&&clearInterval(A),A=setInterval(()=>{p=(p+1)%r.length,i(p)},u)}let L=null;async function v(){try{"wakeLock"in navigator?(L=await navigator.wakeLock.request("screen"),L.addEventListener("release",()=>{setTimeout(v,1e3)})):x()}catch{x()}}function x(){setInterval(()=>{document.dispatchEvent(new Event("mousemove"));const e=document.querySelector(".header");e&&(e.style.transform="translateZ(0)")},3e4),document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen().catch(()=>{})}document.addEventListener("visibilitychange",()=>{document.hidden||v()});window.addEventListener("focus",()=>v());function ie(){(window.innerWidth>=1920||window.innerHeight>=1080)&&le()}function le(){document.body.style.fontSize=window.innerWidth>=3840?"32px":"24px";const e=document.querySelector(".slideshow img");e&&(e.style.borderRadius="16px",e.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.6)")}function P(){if(!(window.innerWidth>=1920))return;const n=window.innerWidth/window.innerHeight,t=document.documentElement;n<=16/9?(t.style.setProperty("--header-height","10vh"),t.style.setProperty("--ayats-height","10vh"),t.style.setProperty("--content-height","70vh"),t.style.setProperty("--gap","2vh"),t.style.setProperty("--padding","2vh")):(t.style.setProperty("--header-height","8vh"),t.style.setProperty("--ayats-height","8vh"),t.style.setProperty("--content-height","74vh"),t.style.setProperty("--gap","2vh"),t.style.setProperty("--padding","2vh"))}window.addEventListener("resize",P);function de(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)-e;setTimeout(()=>window.location.reload(),t)}function ce(){document.documentElement.style.transform="none",document.body.style.transform="none"}window.addEventListener("load",ce);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",M):M();

import{i as r,s as g,b as y,o as v,c as I,d as h,u as E,e as B,f as p}from"./firebase-DK4TXauG.js";const s={signIn:document.getElementById("sign-in-screen"),loading:document.getElementById("loading-screen"),newMosque:document.getElementById("new-mosque-screen"),dashboard:document.getElementById("dashboard-screen")};function d(e){Object.values(s).forEach(t=>{t&&(t.style.display="none")}),s[e]&&(s[e].style.display="")}let l=null,m=null,o=null,n=null;function c(){r(),document.getElementById("google-sign-in-btn")?.addEventListener("click",async()=>{try{await g()}catch(e){console.error("Sign-in failed:",e)}}),document.getElementById("sign-out-btn")?.addEventListener("click",async()=>{await y(),d("signIn")}),v(async e=>{e?(l=e,d("loading"),await f()):(l=null,m=null,o=null,n=null,d("signIn"))}),document.getElementById("new-mosque-form")?.addEventListener("submit",b),document.getElementById("edit-mosque-form")?.addEventListener("submit",q),document.getElementById("preview-btn")?.addEventListener("click",()=>{if(n){const e=window.location.origin+window.location.pathname.replace(/\/admin\.html$/,"/");window.open(`${e}?mosque=${n}`,"_blank")}}),document.getElementById("copy-url-btn")?.addEventListener("click",()=>{const e=document.getElementById("dash-display-url");e&&navigator.clipboard.writeText(e.value).then(()=>{const t=document.getElementById("copy-url-btn");t.textContent="Copied!",setTimeout(()=>{t.textContent="Copy"},2e3)})})}async function f(){try{m=await B(l.uid),m&&m.mosqueId?(n=m.mosqueId,o=await p(n),o?(i(),d("dashboard")):d("newMosque")):d("newMosque")}catch(e){console.error("Failed to load admin data:",e),d("newMosque")}}async function b(e){e.preventDefault();const t=e.target.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Creating...";try{n=crypto.randomUUID();const a={id:n,createdAt:new Date().toISOString(),createdBy:l.uid,mosque:{name:document.getElementById("nm-name").value,shortName:document.getElementById("nm-short-name").value,headerText:document.getElementById("nm-header").value||`Welcome to ${document.getElementById("nm-name").value}`,pageTitle:document.getElementById("nm-page-title").value||`${document.getElementById("nm-name").value} Display`},location:{zipcode:document.getElementById("nm-zipcode").value,country:document.getElementById("nm-country").value||"US",timezone:document.getElementById("nm-timezone").value||"America/New_York"},prayerTimes:{calculationMethod:document.getElementById("nm-calc-method").value,jummahTime:document.getElementById("nm-jummah").value,fallbackTimes:{Fajr:"5:30 AM",Dhuhr:"1:00 PM",Asr:"4:30 PM",Maghrib:"7:00 PM",Isha:"8:30 PM"}},googleDrive:{rootFolderId:document.getElementById("nm-drive-folder").value},display:{slideshowIntervalMs:8e3,ayatRotationIntervalMs:2e4,theme:{headerBg:"rgba(26,26,26,0.8)",panelBg:"rgba(26,26,26,0.8)",accentColor:document.getElementById("nm-accent").value,textColor:document.getElementById("nm-text-color").value}},ayatHadith:"default"};await I(n,a),await h(l.uid,{mosqueId:n,email:l.email,role:"mosque_admin",createdAt:new Date().toISOString()}),o=a,m={mosqueId:n,email:l.email,role:"mosque_admin"},i(),d("dashboard")}catch(a){console.error("Failed to create mosque:",a),t.disabled=!1,t.textContent="Create Mosque",alert("Failed to create mosque. Please try again.")}}function i(){if(!o)return;const e=o;document.getElementById("dash-mosque-name").textContent=e.mosque?.name||"Mosque Dashboard";const t=window.location.origin+window.location.pathname.replace(/\/admin\.html$/,"/");document.getElementById("dash-display-url").value=`${t}?mosque=${n}`,document.getElementById("ed-name").value=e.mosque?.name||"",document.getElementById("ed-short-name").value=e.mosque?.shortName||"",document.getElementById("ed-header").value=e.mosque?.headerText||"",document.getElementById("ed-page-title").value=e.mosque?.pageTitle||"",document.getElementById("ed-zipcode").value=e.location?.zipcode||"",document.getElementById("ed-country").value=e.location?.country||"",document.getElementById("ed-timezone").value=e.location?.timezone||"",document.getElementById("ed-calc-method").value=e.prayerTimes?.calculationMethod||"ISNA",document.getElementById("ed-jummah").value=e.prayerTimes?.jummahTime||"",document.getElementById("ed-drive-folder").value=e.googleDrive?.rootFolderId||"",document.getElementById("ed-slideshow-interval").value=e.display?.slideshowIntervalMs||8e3,document.getElementById("ed-ayat-interval").value=e.display?.ayatRotationIntervalMs||2e4,document.getElementById("ed-accent").value=e.display?.theme?.accentColor||"#ffd700",document.getElementById("ed-text-color").value=e.display?.theme?.textColor||"#ffffff"}async function q(e){e.preventDefault();const t=document.getElementById("save-status"),a=e.target.querySelector('button[type="submit"]');a.disabled=!0,a.textContent="Saving...",t.textContent="",t.className="save-status";try{const u={mosque:{name:document.getElementById("ed-name").value,shortName:document.getElementById("ed-short-name").value,headerText:document.getElementById("ed-header").value,pageTitle:document.getElementById("ed-page-title").value},location:{zipcode:document.getElementById("ed-zipcode").value,country:document.getElementById("ed-country").value,timezone:document.getElementById("ed-timezone").value},prayerTimes:{calculationMethod:document.getElementById("ed-calc-method").value,jummahTime:document.getElementById("ed-jummah").value,fallbackTimes:o?.prayerTimes?.fallbackTimes||{}},googleDrive:{rootFolderId:document.getElementById("ed-drive-folder").value},display:{slideshowIntervalMs:parseInt(document.getElementById("ed-slideshow-interval").value,10)||8e3,ayatRotationIntervalMs:parseInt(document.getElementById("ed-ayat-interval").value,10)||2e4,theme:{headerBg:"rgba(26,26,26,0.8)",panelBg:"rgba(26,26,26,0.8)",accentColor:document.getElementById("ed-accent").value,textColor:document.getElementById("ed-text-color").value}}};await E(n,u),o={...o,...u},document.getElementById("dash-mosque-name").textContent=u.mosque.name||"Mosque Dashboard",t.textContent="Changes saved successfully!",t.className="save-status success"}catch(u){console.error("Failed to save changes:",u),t.textContent="Failed to save. Please try again.",t.className="save-status error"}finally{a.disabled=!1,a.textContent="Save Changes",setTimeout(()=>{t.textContent=""},3e3)}}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",c):c();

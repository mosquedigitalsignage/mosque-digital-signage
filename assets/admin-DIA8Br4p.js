import{i as E,s as I,c as h,o as p,d as B,e as f,u as c,a as b,f as C}from"./firebase-BW6bvVsx.js";const i={signIn:document.getElementById("sign-in-screen"),loading:document.getElementById("loading-screen"),newMosque:document.getElementById("new-mosque-screen"),dashboard:document.getElementById("dashboard-screen")};function s(e){Object.values(i).forEach(t=>{t&&(t.style.display="none")}),i[e]&&(i[e].style.display="")}let m=null,u=null,a=null,l=null;function y(){E(),document.getElementById("google-sign-in-btn")?.addEventListener("click",async()=>{try{await I()}catch(n){console.error("Sign-in failed:",n)}}),document.getElementById("sign-out-btn")?.addEventListener("click",async()=>{await h(),s("signIn")}),p(async n=>{n?(m=n,s("loading"),await w()):(m=null,u=null,a=null,l=null,s("signIn"))}),document.getElementById("new-mosque-form")?.addEventListener("submit",q),document.getElementById("edit-mosque-form")?.addEventListener("submit",x),document.getElementById("add-announcement-btn")?.addEventListener("click",g),document.getElementById("new-announcement-text")?.addEventListener("keydown",n=>{n.key==="Enter"&&(n.preventDefault(),g())});const e=document.getElementById("announcement-color"),t=document.getElementById("announcement-color-value");e?.addEventListener("input",()=>{t.textContent=e.value}),e?.addEventListener("change",T),document.getElementById("reset-announcement-color-btn")?.addEventListener("click",L),document.getElementById("save-custom-ayats-btn")?.addEventListener("click",F),document.getElementById("reset-ayats-btn")?.addEventListener("click",S),document.getElementById("preview-btn")?.addEventListener("click",()=>{if(l){const n=window.location.origin+window.location.pathname.replace(/\/admin\.html$/,"/");window.open(`${n}?mosque=${l}`,"_blank")}}),document.getElementById("copy-url-btn")?.addEventListener("click",()=>{const n=document.getElementById("dash-display-url");n&&navigator.clipboard.writeText(n.value).then(()=>{const o=document.getElementById("copy-url-btn");o.textContent="Copied!",setTimeout(()=>{o.textContent="Copy"},2e3)})})}async function w(){try{u=await b(m.uid),u&&u.mosqueId?(l=u.mosqueId,a=await C(l),a?(v(),s("dashboard")):s("newMosque")):s("newMosque")}catch(e){console.error("Failed to load admin data:",e),s("newMosque")}}async function q(e){e.preventDefault();const t=e.target.querySelector('button[type="submit"]');t.disabled=!0,t.textContent="Creating...";try{l=crypto.randomUUID();const n={id:l,createdAt:new Date().toISOString(),createdBy:m.uid,mosque:{name:document.getElementById("nm-name").value,shortName:document.getElementById("nm-short-name").value,headerText:document.getElementById("nm-header").value||`Welcome to ${document.getElementById("nm-name").value}`,pageTitle:document.getElementById("nm-page-title").value||`${document.getElementById("nm-name").value} Display`},location:{zipcode:document.getElementById("nm-zipcode").value,country:document.getElementById("nm-country").value||"US",timezone:document.getElementById("nm-timezone").value||"America/New_York"},prayerTimes:{calculationMethod:document.getElementById("nm-calc-method").value,jummahTime:document.getElementById("nm-jummah").value,fallbackTimes:{Fajr:"5:30 AM",Dhuhr:"1:00 PM",Asr:"4:30 PM",Maghrib:"7:00 PM",Isha:"8:30 PM"}},googleDrive:{rootFolderId:document.getElementById("nm-drive-folder").value},display:{slideshowIntervalMs:8e3,ayatRotationIntervalMs:2e4,theme:{headerBg:"rgba(26,26,26,0.8)",panelBg:"rgba(26,26,26,0.8)",accentColor:"#3b82f6",textColor:"#ffffff"}},ayatHadith:"default"};await B(l,n),await f(m.uid,{mosqueId:l,email:m.email,role:"mosque_admin",createdAt:new Date().toISOString()}),a=n,u={mosqueId:l,email:m.email,role:"mosque_admin"},v(),s("dashboard")}catch(n){console.error("Failed to create mosque:",n),t.disabled=!1,t.textContent="Create Mosque",alert("Failed to create mosque. Please try again.")}}function v(){if(!a)return;const e=a;document.getElementById("dash-mosque-name").textContent=e.mosque?.name||"Mosque Dashboard";const t=window.location.origin+window.location.pathname.replace(/\/admin\.html$/,"/");document.getElementById("dash-display-url").value=`${t}?mosque=${l}`,document.getElementById("ed-name").value=e.mosque?.name||"",document.getElementById("ed-short-name").value=e.mosque?.shortName||"",document.getElementById("ed-header").value=e.mosque?.headerText||"",document.getElementById("ed-page-title").value=e.mosque?.pageTitle||"",document.getElementById("ed-zipcode").value=e.location?.zipcode||"",document.getElementById("ed-country").value=e.location?.country||"",document.getElementById("ed-timezone").value=e.location?.timezone||"",document.getElementById("ed-calc-method").value=e.prayerTimes?.calculationMethod||"ISNA",document.getElementById("ed-jummah").value=e.prayerTimes?.jummahTime||"",document.getElementById("ed-drive-folder").value=e.googleDrive?.rootFolderId||"",document.getElementById("ed-slideshow-interval").value=e.display?.slideshowIntervalMs||8e3,document.getElementById("ed-ayat-interval").value=e.display?.ayatRotationIntervalMs||2e4,r();const n=e.display?.announcementColor||e.display?.theme?.accentColor||"#3b82f6";document.getElementById("announcement-color").value=n,document.getElementById("announcement-color-value").textContent=n;const o=e.customAyats||[];document.getElementById("custom-ayats-textarea").value=o.map(d=>d.en).join(`
`)}async function x(e){e.preventDefault();const t=document.getElementById("save-status"),n=e.target.querySelector('button[type="submit"]');n.disabled=!0,n.textContent="Saving...",t.textContent="",t.className="save-status";try{const o={mosque:{name:document.getElementById("ed-name").value,shortName:document.getElementById("ed-short-name").value,headerText:document.getElementById("ed-header").value,pageTitle:document.getElementById("ed-page-title").value},location:{zipcode:document.getElementById("ed-zipcode").value,country:document.getElementById("ed-country").value,timezone:document.getElementById("ed-timezone").value},prayerTimes:{calculationMethod:document.getElementById("ed-calc-method").value,jummahTime:document.getElementById("ed-jummah").value,fallbackTimes:a?.prayerTimes?.fallbackTimes||{}},googleDrive:{rootFolderId:document.getElementById("ed-drive-folder").value},display:{slideshowIntervalMs:parseInt(document.getElementById("ed-slideshow-interval").value,10)||8e3,ayatRotationIntervalMs:parseInt(document.getElementById("ed-ayat-interval").value,10)||2e4,theme:{headerBg:"rgba(26,26,26,0.8)",panelBg:"rgba(26,26,26,0.8)",accentColor:"#3b82f6",textColor:"#ffffff"}}};await c(l,o),a={...a,...o},document.getElementById("dash-mosque-name").textContent=o.mosque.name||"Mosque Dashboard",t.textContent="Changes saved successfully!",t.className="save-status success"}catch(o){console.error("Failed to save changes:",o),t.textContent="Failed to save. Please try again.",t.className="save-status error"}finally{n.disabled=!1,n.textContent="Save Changes",setTimeout(()=>{t.textContent=""},3e3)}}function r(){const e=document.getElementById("announcements-list");if(!e)return;const t=a?.announcements||[];if(t.length===0){e.innerHTML='<p class="empty-text">No announcements yet.</p>';return}e.innerHTML="",t.forEach((n,o)=>{const d=document.createElement("div");d.className="managed-item"+(n.enabled?"":" disabled"),d.innerHTML=`
      <span class="managed-item-text">${n.text}</span>
      <div class="managed-item-actions">
        <button class="btn btn-sm btn-outline" data-action="toggle" data-idx="${o}">
          ${n.enabled?"Disable":"Enable"}
        </button>
        <button class="btn btn-sm btn-danger" data-action="delete" data-idx="${o}">Delete</button>
      </div>
    `,e.appendChild(d)}),e.querySelectorAll('[data-action="toggle"]').forEach(n=>{n.addEventListener("click",()=>M(parseInt(n.dataset.idx,10)))}),e.querySelectorAll('[data-action="delete"]').forEach(n=>{n.addEventListener("click",()=>A(parseInt(n.dataset.idx,10)))})}async function g(){const e=document.getElementById("new-announcement-text"),t=e.value.trim();if(!t)return;const n=a?.announcements||[];n.push({text:t,enabled:!0});try{await c(l,{announcements:n}),a.announcements=n,e.value="",r()}catch(o){console.error("Failed to add announcement:",o),alert("Failed to add announcement.")}}async function M(e){const t=[...a?.announcements||[]];if(t[e]){t[e]={...t[e],enabled:!t[e].enabled};try{await c(l,{announcements:t}),a.announcements=t,r()}catch(n){console.error("Failed to toggle announcement:",n)}}}async function A(e){const t=[...a?.announcements||[]];t.splice(e,1);try{await c(l,{announcements:t}),a.announcements=t,r()}catch(n){console.error("Failed to delete announcement:",n)}}async function T(){const e=document.getElementById("announcement-color").value;try{await c(l,{display:{...a.display,announcementColor:e}}),a.display={...a.display,announcementColor:e}}catch(t){console.error("Failed to save announcement color:",t)}}async function L(){const e=a?.display?.theme?.accentColor||"#3b82f6";document.getElementById("announcement-color").value=e,document.getElementById("announcement-color-value").textContent=e;try{await c(l,{display:{...a.display,announcementColor:e}}),a.display={...a.display,announcementColor:e}}catch(t){console.error("Failed to reset announcement color:",t)}}async function F(){const e=document.getElementById("custom-ayats-textarea"),t=document.getElementById("ayat-save-status"),o=e.value.split(`
`).map(d=>d.trim()).filter(d=>d.length>0).map(d=>({en:d}));try{await c(l,{customAyats:o}),a.customAyats=o,t.textContent=`Saved ${o.length} custom ayat(s).`,t.className="save-status success"}catch(d){console.error("Failed to save custom ayats:",d),t.textContent="Failed to save. Please try again.",t.className="save-status error"}setTimeout(()=>{t.textContent=""},3e3)}async function S(){const e=document.getElementById("custom-ayats-textarea"),t=document.getElementById("ayat-save-status");try{await c(l,{customAyats:[]}),a.customAyats=[],e.value="",t.textContent="Reset to default ayats.",t.className="save-status success"}catch(n){console.error("Failed to reset ayats:",n),t.textContent="Failed to reset. Please try again.",t.className="save-status error"}setTimeout(()=>{t.textContent=""},3e3)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",y):y();

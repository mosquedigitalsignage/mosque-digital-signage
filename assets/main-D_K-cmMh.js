import{i as B,f as W,a as H,s as j,b as R}from"./firebase-BjvPovYL.js";const O="AIzaSyD1g0WI_N1leSgBp92xcZ546MWkOo1kElQ",_="https://www.googleapis.com/drive/v3";async function E(e){const n=`'${e}' in parents and trashed = false`,o=`${_}/files?q=${encodeURIComponent(n)}&fields=${encodeURIComponent("files(id,name,mimeType)")}&key=${O}&orderBy=name`,a=await fetch(o);if(!a.ok)throw new Error(`Drive API error: ${a.status} ${a.statusText}`);return(await a.json()).files||[]}function S(e){return`https://drive.google.com/thumbnail?id=${e}&sz=w1600`}async function D(e){const n=await E(e);let t=null,o=null,a=null;for(const r of n){const i=r.name.toLowerCase();r.mimeType==="application/vnd.google-apps.folder"?i==="slideshow"?t=r.id:i==="qr-codes"&&(o=r.id):i.startsWith("background.")&&r.mimeType.startsWith("image/")&&(a=r.id)}return{slideshowFolderId:t,qrCodesFolderId:o,backgroundFileId:a}}async function Q(e){const n=await E(e),t=["jpg","jpeg","png","gif","webp"];return n.filter(o=>{const a=o.name.toLowerCase().split(".").pop();return t.includes(a)||o.mimeType.startsWith("image/")}).map(o=>({id:o.id,name:o.name,url:S(o.id)}))}async function U(e){const n=await E(e),t=["jpg","jpeg","png","gif","webp"];return n.filter(o=>{const a=o.name.toLowerCase().split(".").pop();return t.includes(a)||o.mimeType.startsWith("image/")}).sort((o,a)=>o.name.localeCompare(a.name)).slice(0,4).map(o=>{const a=o.name.replace(/\.[^.]+$/,"");return{id:o.id,name:o.name,label:a,url:S(o.id)}})}const z={ISNA:2,MWL:3,"Umm Al-Qura":4,Egyptian:5,Karachi:1,Tehran:7,"Shia Ithna-Ashari":0},V=[{ar:"إِنَّ الصَّلَاةَ تَنْهَىٰ عَنِ الْفَحْشَاءِ وَالْمُنكَرِ",en:"Indeed, prayer prohibits immorality and wrongdoing. (Quran 29:45)"},{ar:"وَمَا خَلَقْتُ الْجِنَّ وَالْإِنسَ إِلَّا لِيَعْبُدُونِ",en:"I did not create the jinn and mankind except to worship Me. (Quran 51:56)"},{ar:"فَاذْكُرُونِي أَذْكُرْكُمْ",en:"So remember Me; I will remember you. (Quran 2:152)"},{ar:"وَمَن يَتَوَكَّلْ عَلَى اللَّهِ فَهُوَ حَسْبُهُ",en:"And whoever puts his trust in Allah, then He will suffice him. (Quran 65:3)"},{ar:"إِنَّ اللَّهَ مَعَ الصَّابِرِينَ",en:"Indeed, Allah is with the patient. (Quran 2:153)"},{ar:"وَلَا تَيْأَسُوا مِن رَّوْحِ اللَّهِ",en:"And never give up hope of Allah's mercy. (Quran 12:87)"},{ar:"إِنَّ اللَّهَ لَا يُضِيعُ أَجْرَ الْمُحْسِنِينَ",en:"Indeed, Allah does not allow the reward of the doers of good to be lost. (Quran 9:120)"},{ar:"وَمَن يَتَّقِ اللَّهَ يَجْعَل لَّهُ مَخْرَجًا",en:"And whoever fears Allah, He will make for him a way out. (Quran 65:2)"},{ar:"إِنَّمَا الْمُؤْمِنُونَ إِخْوَةٌ",en:"The believers are but brothers. (Quran 49:10)"},{ar:"لَا يُؤْمِنُ أَحَدُكُمْ حَتَّى يُحِبَّ لأَخِيهِ مَا يُحِبُّ لِنَفْسِهِ",en:"None of you truly believes until he loves for his brother what he loves for himself. (Bukhari & Muslim)"},{ar:"خَيْرُكُمْ أَحْسَنُكُمْ أَخْلَاقًا",en:"The best among you are those who have the best manners and character. (Bukhari)"},{ar:"مَنْ لَا يَشْكُرِ النَّاسَ لَا يَشْكُرِ اللَّهَ",en:"Whoever does not thank people has not thanked Allah. (Tirmidhi)"},{ar:"لَيْسَ الشَّدِيدُ بِالصُّرَعَةِ، إِنَّمَا الشَّدِيدُ الَّذِي يَمْلِكُ نَفْسَهُ عِندَ الْغَضَبِ",en:"The strong man is not the one who can overpower others. The strong man is the one who controls himself when angry. (Bukhari)"},{ar:"يَسِّرُوا وَلَا تُعَسِّرُوا",en:"Make things easy and do not make them difficult. (Bukhari)"},{ar:"وَلَا تَنَابَزُوا بِالْأَلْقَابِ",en:"And do not insult one another with nicknames. (Quran 49:11)"},{ar:"إِنَّ اللَّهَ يُحِبُّ الْمُحْسِنِينَ",en:"Indeed, Allah loves the doers of good. (Quran 2:195)"},{ar:"اقْرَأْ بِاسْمِ رَبِّكَ الَّذِي خَلَقَ",en:"Read in the name of your Lord who created. (Quran 96:1)"},{ar:"إِنَّ هَٰذَا الْقُرْآنَ يَهْدِي لِلَّتِي هِيَ أَقْوَمُ",en:"Indeed, this Quran guides to that which is most upright. (Quran 17:9)"},{ar:"وَلَقَدْ يَسَّرْنَا الْقُرْآنَ لِلذِّكْرِ",en:"And We have certainly made the Quran easy for remembrance. (Quran 54:17)"},{ar:"إِنَّ الَّذِينَ يَتْلُونَ كِتَابَ اللَّهِ وَأَقَامُوا الصَّلَاةَ",en:"Indeed, those who recite the Book of Allah and establish prayer. (Quran 35:29)"},{ar:"طَلَبُ الْعِلْمِ فَرِيضَةٌ عَلَى كُلِّ مُسْلِمٍ",en:"Seeking knowledge is obligatory upon every Muslim. (Ibn Majah)"},{ar:"مَنْ سَلَكَ طَرِيقًا يَلْتَمِسُ فِيهِ عِلْمًا",en:"Whoever takes a path in search of knowledge. (Abu Dawud)"},{ar:"إِنَّمَا يَخْشَى اللَّهَ مِنْ عِبَادِهِ الْعُلَمَاءُ",en:"Only those of His servants who have knowledge fear Allah. (Quran 35:28)"},{ar:"وَقُل رَّبِّ زِدْنِي عِلْمًا",en:"And say: My Lord, increase me in knowledge. (Quran 20:114)"},{ar:"مَنْ أَحْيَا سُنَّتِي فَقَدْ أَحْيَانِي",en:"Whoever revives my Sunnah has indeed revived me. (Tirmidhi)"},{ar:"مَنْ رَغِبَ عَنْ سُنَّتِي فَلَيْسَ مِنِّي",en:"Whoever turns away from my Sunnah is not from me. (Bukhari & Muslim)"},{ar:"مَنْ أَطَاعَنِي فَقَدْ أَطَاعَ اللَّهَ",en:"Whoever obeys me has obeyed Allah. (Bukhari & Muslim)"},{ar:"مَنْ رَأَى مِنْكُمْ مُنْكَرًا فَلْيُغَيِّرْهُ",en:"Whoever among you sees an evil, let him change it. (Muslim)"},{ar:"لَا يُؤْمِنُ أَحَدُكُمْ حَتَّى أَكُونَ أَحَبَّ إِلَيْهِ",en:"None of you truly believes until I am dearer to him than his father. (Bukhari)"},{ar:"إِنَّ اللَّهَ وَمَلَائِكَتَهُ يُصَلُّونَ عَلَى النَّبِيِّ",en:"Indeed, Allah and His angels send blessings upon the Prophet. (Quran 33:56)"},{ar:"قُلْ إِن كُنتُمْ تُحِبُّونَ اللَّهَ فَاتَّبِعُونِي",en:"Say: If you love Allah, then follow me. (Quran 3:31)"},{ar:"وَمَنْ أَظْلَمُ مِمَّن مَّنَعَ مَسَاجِدَ اللَّهِ أَن يُذْكَرَ فِيهَا اسْمُهُ",en:"And who is more unjust than one who prevents the mention of Allah's name in His mosques? (Quran 2:114)"},{ar:"مَنْ بَنَى مَسْجِدًا لِلَّهِ بَنَى اللَّهُ لَهُ بَيْتًا فِي الْجَنَّةِ",en:"Whoever builds a mosque for Allah, Allah will build for him a house in Paradise. (Bukhari & Muslim)"},{ar:"إِنَّ الْمَسَاجِدَ لِلَّهِ فَلَا تَدْعُوا مَعَ اللَّهِ أَحَدًا",en:"Indeed, the mosques are for Allah, so do not invoke anyone with Allah. (Quran 72:18)"},{ar:"فِي بُيُوتٍ أَذِنَ اللَّهُ أَن تُرْفَعَ وَيُذْكَرَ فِيهَا اسْمُهُ",en:"In houses which Allah has ordered to be raised and in which His name is mentioned. (Quran 24:36)"},{ar:"يَوْمَ تَشْهَدُ عَلَيْهِمْ أَلْسِنَتُهُمْ وَأَيْدِيهِمْ وَأَرْجُلُهُم بِمَا كَانُوا يَعْمَلُونَ",en:"On the Day when their tongues, hands and feet will bear witness against them as to what they used to do. (Quran 24:24)"},{ar:"فَمَن يَعْمَلْ مِثْقَالَ ذَرَّةٍ خَيْرًا يَرَهُ * وَمَن يَعْمَلْ مِثْقَالَ ذَرَّةٍ شَرًّا يَرَهُ",en:"So whoever does an atom's weight of good will see it. And whoever does an atom's weight of evil will see it. (Quran 99:7-8)"},{ar:"يَوْمَ لَا تَمْلِكُ نَفْسٌ لِّنَفْسٍ شَيْئًا",en:"On the Day when no soul will have power to do anything for another soul. (Quran 82:19)"},{ar:"وَكُلُّ إِنسَانٍ أَلْزَمْنَاهُ طَائِرَهُ فِي عُنُقِهِ",en:"And every person's fate We have fastened around his neck. (Quran 17:13)"}];let s=null,p=null,m=[],f=0,q=null,A=null,g=0;function w(e){return`mosque_${p}_${e}`}const G=1440*60*1e3;async function k(){if(B(),p=new URLSearchParams(window.location.search).get("mosque"),!p){Z();return}try{s=await W(p)}catch(n){console.error("Failed to fetch mosque config:",n),T("Unable to load mosque configuration. Please check your connection and try again.");return}if(!s){T("Mosque not found. The mosque ID in the URL may be incorrect.");return}J(),await K()}function J(){const e=s;document.title=e.mosque?.pageTitle||e.mosque?.name||"Mosque Digital Signage";const n=document.querySelector(".header");n&&(n.textContent=e.mosque?.headerText||`Welcome to ${e.mosque?.name||"Our Mosque"}`);const t=e.display?.theme;if(t){const o=document.documentElement;t.headerBg&&o.style.setProperty("--header-bg",t.headerBg),t.panelBg&&o.style.setProperty("--panel-bg",t.panelBg),t.accentColor&&o.style.setProperty("--accent-color",t.accentColor),t.textColor&&o.style.setProperty("--text-color",t.textColor)}}async function K(){await v(),me(),P(),de(),ce(),await ee(),he()}function Y(){const e=navigator.userAgent.toLowerCase();return e.includes("tv")||e.includes("leanback")||e.includes("mosque-digital-signage-tv")||window.innerWidth>=1920}async function Z(){const e=document.querySelector(".main-layout");if(!e)return;const n=!Y();e.innerHTML=`
    <div class="selector-screen">
      <h1>Mosque Digital Signage</h1>
      <p>Select your mosque</p>
      ${n?`
        <button class="admin-signin-btn" id="admin-signin-btn">Sign in as Admin</button>
        <div class="signin-divider"><span>or browse all mosques</span></div>
      `:""}
      <div class="mosque-list" id="mosque-list">
        <p class="loading-text">Loading mosques...</p>
      </div>
    </div>
  `,n&&document.getElementById("admin-signin-btn").addEventListener("click",X);const t=document.getElementById("mosque-list");try{const o=await H();if(o.length===0){t.innerHTML='<p>No mosques configured yet. Visit the <a href="admin.html">admin dashboard</a> to set one up.</p>';return}t.innerHTML="",o.forEach(a=>{const r=document.createElement("a");r.className="mosque-card",r.href=`?mosque=${a.id}`,r.innerHTML=`
        <div class="mosque-card-name">${a.name}</div>
        ${a.shortName?`<div class="mosque-card-short">${a.shortName}</div>`:""}
      `,t.appendChild(r)})}catch(o){console.error("Failed to load mosques:",o),t.innerHTML='<p class="error-text">Failed to load mosques. Please check your connection and try again.</p>'}}async function X(){const e=document.getElementById("admin-signin-btn");e&&(e.disabled=!0,e.textContent="Signing in...");try{const t=(await j()).user.uid,o=await R(t);o&&o.mosqueId?window.location.href=`?mosque=${o.mosqueId}`:e&&(e.textContent="No mosque found for this account",e.disabled=!1,setTimeout(()=>{e.textContent="Sign in as Admin"},3e3))}catch(n){console.error("Admin sign-in failed:",n),e&&(e.textContent="Sign-in failed. Try again.",e.disabled=!1,setTimeout(()=>{e.textContent="Sign in as Admin"},3e3))}}function T(e){const n=document.querySelector(".main-layout");n&&(n.innerHTML=`
    <div class="error-screen">
      <h1>Mosque Digital Signage</h1>
      <div class="error-message">${e}</div>
      <a href="?" class="error-link">Browse all mosques</a>
    </div>
  `)}async function ee(){const e=s?.googleDrive?.rootFolderId;if(!e){console.log("No Google Drive folder configured, using placeholder content."),C();return}try{const n=te();if(n){M(n);return}const t=await D(e),o={slideshowImages:[],qrCodes:[],backgroundFileId:t.backgroundFileId};t.slideshowFolderId&&(o.slideshowImages=await Q(t.slideshowFolderId)),t.qrCodesFolderId&&(o.qrCodes=await U(t.qrCodesFolderId)),ne(o),M(o)}catch(n){console.error("Failed to load Drive content:",n),C()}}function te(){try{const e=localStorage.getItem(w("drive_content"));if(!e)return null;const n=JSON.parse(e);return Date.now()-n.timestamp>G?(localStorage.removeItem(w("drive_content")),null):n.content}catch{return null}}function ne(e){try{localStorage.setItem(w("drive_content"),JSON.stringify({timestamp:Date.now(),content:e}))}catch(n){console.warn("Failed to cache Drive content:",n)}}function M(e){if(e.backgroundFileId){const n=S(e.backgroundFileId),t=document.createElement("img");t.referrerPolicy="no-referrer",t.src=n,t.alt="",t.style.cssText="position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;pointer-events:none;",document.body.prepend(t)}e.slideshowImages&&e.slideshowImages.length>0?(m=e.slideshowImages.map(n=>n.url),f=0,F(f),ae(),se(m)):C(),e.qrCodes&&e.qrCodes.length>0?ie(e.qrCodes):le()}const c=document.getElementById("slideshow-img");function F(e){m.length===0||!c||(c.style.opacity=0,setTimeout(()=>{c.setAttribute("referrerpolicy","no-referrer"),c.src=m[e],c.onload=()=>{c.style.opacity=1},c.onerror=()=>{console.warn("Image failed to load:",m[e]),c.style.opacity=.2}},300))}function oe(){m.length!==0&&(f===m.length-1&&re(),f=(f+1)%m.length,F(f))}function ae(){q&&clearInterval(q);const e=s?.display?.slideshowIntervalMs||8e3;q=setInterval(oe,e)}async function re(){const e=s?.googleDrive?.rootFolderId;if(e)try{localStorage.removeItem(w("drive_content"));const n=await D(e);if(n.slideshowFolderId){const t=await Q(n.slideshowFolderId);t.length>0&&(m=t.map(o=>o.url),f>=m.length&&(f=0))}}catch(n){console.warn("Failed to refresh Drive images:",n)}}function C(){if(!c)return;c.style.display="none";const e=document.querySelector(".slideshow");if(e&&!e.querySelector(".placeholder-text")){const n=document.createElement("div");n.className="placeholder-text",n.textContent="No slideshow images configured. Add images to Google Drive.",e.appendChild(n)}}function se(e){const n=document.querySelector(".slideshow");if(!n)return;const t=document.createElement("div");t.className="slideshow-gallery",e.forEach(o=>{const a=document.createElement("img");a.src=o,a.alt="Slideshow",a.setAttribute("referrerpolicy","no-referrer"),a.loading="lazy",t.appendChild(a)}),n.appendChild(t)}function ie(e){const n=document.querySelector(".qr-list");n&&(n.innerHTML="",e.forEach(t=>{const o=document.createElement("div");o.className="qr-wrapper";const a=document.createElement("div");a.className="qr-label",a.textContent=t.label;const r=document.createElement("img");r.className="qr-img",r.alt=t.label,r.setAttribute("referrerpolicy","no-referrer"),r.src=t.url,r.onerror=()=>{r.style.display="none";const i=document.createElement("div");i.className="qr-fallback",i.textContent=`QR: ${t.label}`,o.appendChild(i)},o.appendChild(a),o.appendChild(r),n.appendChild(o)}))}function le(){const e=document.querySelector(".qr-list");e&&(e.innerHTML='<div class="placeholder-text">No QR codes configured.</div>')}function de(){const e=document.getElementById("prayer-times-list");if(!e)return;e.innerHTML="";const n=s?.location?.zipcode||"10001",t=s?.location?.country||"US",o=s?.prayerTimes?.calculationMethod||"ISNA",a=z[o]||2;fetch(`https://api.aladhan.com/v1/timingsByAddress?address=${n},${t}&method=${a}`).then(r=>r.json()).then(r=>{const i=r.data.timings;["Fajr","Dhuhr","Asr","Maghrib","Isha"].forEach(l=>{let u=i[l];if(u){u=u.replace(/\s*\(.*\)$/,"");let[$,N]=u.split(":"),y=parseInt($,10),b="AM";y===0?y=12:y===12?b="PM":y>12&&(y-=12,b="PM"),u=`${y}:${N} ${b}`}const I=document.createElement("li");I.textContent=`${l}: ${u}`,I.className="prayer-time-item",e.appendChild(I)});const d=s?.prayerTimes?.jummahTime;if(d){const l=document.createElement("li");l.textContent=`Jummah: ${d}`,l.className="prayer-time-item",e.appendChild(l)}}).catch(()=>{const r=s?.prayerTimes?.fallbackTimes||{Fajr:"5:30 AM",Dhuhr:"1:00 PM",Asr:"4:30 PM",Maghrib:"7:00 PM",Isha:"8:30 PM"};Object.entries(r).forEach(([h,d])=>{const l=document.createElement("li");l.textContent=`${h}: ${d}`,l.className="prayer-time-item",e.appendChild(l)});const i=s?.prayerTimes?.jummahTime;if(i){const h=document.createElement("li");h.textContent=`Jummah: ${i}`,h.className="prayer-time-item",e.appendChild(h)}})}function ce(){const e=document.getElementById("ayats-content");if(!e)return;const n=(s?.announcements||[]).filter(d=>d.enabled),t=document.querySelector(".ayats"),o=document.querySelector(".main-layout");let a;const r=document.getElementById("mobile-announcement");if(n.length>0){a=n.map(l=>({en:l.text}));const d=s?.display?.announcementColor||s?.display?.theme?.accentColor||"#3b82f6";t&&(t.classList.add("has-announcements"),t.style.setProperty("--announcement-color",d)),o&&o.classList.add("has-announcements-layout"),r&&(r.style.display="",r.style.setProperty("--announcement-color",d))}else r&&(r.style.display="none"),t&&t.classList.remove("has-announcements"),o&&o.classList.remove("has-announcements-layout"),s?.customAyats&&s.customAyats.length>0?a=s.customAyats:a=V;g=0;function i(d){const u=a[d].en.replace(/[.]+(?=\s*\()/,"");e.innerHTML=`<div class="ayat-text">${u}</div>`,r&&n.length>0&&(r.textContent=u)}i(g);const h=s?.display?.ayatRotationIntervalMs||2e4;A&&clearInterval(A),A=setInterval(()=>{g=(g+1)%a.length,i(g)},h)}let L=null;async function v(){try{"wakeLock"in navigator?(L=await navigator.wakeLock.request("screen"),L.addEventListener("release",()=>{setTimeout(v,1e3)})):x()}catch{x()}}function x(){setInterval(()=>{document.dispatchEvent(new Event("mousemove"));const e=document.querySelector(".header");e&&(e.style.transform="translateZ(0)")},3e4),document.documentElement.requestFullscreen&&document.documentElement.requestFullscreen().catch(()=>{})}document.addEventListener("visibilitychange",()=>{document.hidden||v()});window.addEventListener("focus",()=>v());function me(){(window.innerWidth>=1920||window.innerHeight>=1080)&&ue()}function ue(){document.body.style.fontSize=window.innerWidth>=3840?"32px":"24px";const e=document.querySelector(".slideshow img");e&&(e.style.borderRadius="16px",e.style.boxShadow="0 8px 32px rgba(0, 0, 0, 0.6)")}function P(){if(!(window.innerWidth>=1920))return;const n=window.innerWidth/window.innerHeight,t=document.documentElement;n<=16/9?(t.style.setProperty("--header-height","10vh"),t.style.setProperty("--ayats-height","10vh"),t.style.setProperty("--content-height","70vh"),t.style.setProperty("--gap","2vh"),t.style.setProperty("--padding","2vh")):(t.style.setProperty("--header-height","8vh"),t.style.setProperty("--ayats-height","8vh"),t.style.setProperty("--content-height","74vh"),t.style.setProperty("--gap","2vh"),t.style.setProperty("--padding","2vh"))}window.addEventListener("resize",P);function he(){const e=new Date,t=new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)-e;setTimeout(()=>window.location.reload(),t)}function fe(){document.documentElement.style.transform="none",document.body.style.transform="none"}window.addEventListener("load",fe);document.readyState==="loading"?document.addEventListener("DOMContentLoaded",k):k();
